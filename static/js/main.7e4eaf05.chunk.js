(this["webpackJsonphome-climate-monitor"]=this["webpackJsonphome-climate-monitor"]||[]).push([[0],{31:function(e,t,a){},32:function(e,t,a){},57:function(e,t,a){"use strict";a.r(t);var r=a(2),i=a.n(r),n=a(24),s=a.n(n),c=(a(31),a(32),a(1)),l=a.n(c),d=a(4),o=a(6),u=a(7),h=a(3),p=a(9),v=a(8),m=(a(34),a(13)),b=a.n(m),j=a(0),f=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleClick=r.handleClick.bind(Object(h.a)(r)),r}return Object(u.a)(a,[{key:"dateToUTC",value:function(e){return Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}},{key:"lastReadingWarning",value:function(){var e=new Date(this.props.date),t=this.dateToUTC(e),a=new Date;return(this.dateToUTC(a)-t)/1e3>3600}},{key:"handleClick",value:function(e){this.props.clickHandler(this.props.title)}},{key:"formatDate",value:function(e){var t=navigator.language;return new Intl.DateTimeFormat(t,{dateStyle:"short",timeStyle:"short",hour12:!1}).format(new Date(e))}},{key:"render",value:function(){return Object(j.jsx)("div",{className:"col s12 m5 l3",children:Object(j.jsx)("div",{className:"card card-pointer blue-grey ".concat(this.props.selected?"darken-3":"darken-4"),onClick:this.handleClick,children:Object(j.jsx)("div",{className:"card grey ".concat(this.props.selected?"darken-3":"darken-4"),children:Object(j.jsxs)("div",{className:"card-content white-text",children:[Object(j.jsx)("span",{className:"card-span",children:this.props.title?this.props.title:"Title"}),this.lastReadingWarning()?Object(j.jsx)("span",{className:"card-warning-icon",children:Object(j.jsx)("i",{className:"material-icons yellow-text",children:"warning"})}):null,Object(j.jsx)("span",{className:"card-title",children:this.props.temperature?this.props.temperature.toFixed(1)+"\xb0C":"Temperature Error"}),Object(j.jsx)("p",{className:"card-span",children:this.props.humidity?this.props.humidity+"%":Object(j.jsx)("br",{})}),Object(j.jsx)("div",{className:"divider"}),Object(j.jsx)("span",{className:"card-span ".concat(this.lastReadingWarning()&&"red-text"),children:this.props.date?this.formatDate(this.props.date):"Date Error"})]})})})})}}]),a}(r.Component),y=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).getDeviceDescription=function(e){var t=r.props.devices.filter((function(t){return e===t.serial}));return 0!==t.length?t[0].description:""},r.dateTimeIsWithinLast2Days=function(e){var t=new Date(e),a=new Date;return a.setDate(a.getDate()-2),t.getTime()>a},r.deviceCard=function(){if(null!==r.props.readings&&void 0!==r.props.readings[0])return r.props.readings.map((function(e){return void 0!==e[0]&&r.dateTimeIsWithinLast2Days(e[0].timestamp)?Object(j.jsx)(f,{title:r.getDeviceDescription(e[0].serial),humidity:e[0].humidity,temperature:e[0].temperature,date:e[0].timestamp,clickHandler:r.clickHandler,selected:r.props.selectedDevice===r.getDeviceDescription(e[0].serial)},e[0].serial):""}))},r.clickHandler=r.clickHandler.bind(Object(h.a)(r)),r}return Object(u.a)(a,[{key:"clickHandler",value:function(e){this.props.clickHandler(e)}},{key:"render",value:function(){return Object(j.jsx)("div",{className:"row",children:void 0!==this.props.devices?this.deviceCard():""})}}]),a}(r.Component),x=a(25),g=a.n(x),O=a(26),k=a.n(O)()(g.a),D=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).state={labels:[],label:null,xData:[],yData:[],dateData:[],chartData:{},options:{}},r}return Object(u.a)(a,[{key:"getMinOfArray",value:function(e){return Math.min.apply(null,e)}},{key:"getMaxOfArray",value:function(e){return Math.max.apply(null,e)}},{key:"componentDidMount",value:function(){var e=Math.floor(this.getMinOfArray(this.props.yDataLeft)),t=Math.ceil(this.getMaxOfArray(this.props.yDataLeft)),a=Math.round(this.getMinOfArray(this.props.yDataRight)-1),r=Math.round(this.getMaxOfArray(this.props.yDataRight)+1);this.setState({minY1:e,maxY1:t,options:{color:"#FFF",elements:{point:{radius:0}},responsive:!0,scales:{y:{type:"linear",position:"left",grid:{color:"rgba(255, 255, 255, 0.1)"},min:e,max:t,ticks:{display:!0,stepSize:.5,color:"rgba(255, 255, 255, 0.7)"}},y1:{type:"linear",position:"right",grid:{drawOnChartArea:!1},min:a,max:r,ticks:{display:!0,stepSize:1,color:"rgba(255, 255, 255, 0.7)"}},x:{grid:{color:"rgba(255, 255, 255, 0.1)"},ticks:{display:!0,color:"rgba(255, 255, 255, 0.7)"}}}}})}},{key:"componentDidUpdate",value:function(e,t){if(e.yDataLeft!==this.props.yDataLeft){var a=Math.floor(this.getMinOfArray(this.props.yDataLeft)),r=Math.ceil(this.getMaxOfArray(this.props.yDataLeft));this.setState({minY1:a,maxY1:r})}}},{key:"render",value:function(){return Object(j.jsx)(k,{data:[{x:this.props.xData,y:this.props.yDataLeft,name:"Temperature",mode:"lines",hovertemplate:" %{y:.1f}&deg;C"},{x:this.props.xData,y:this.props.yDataRight,yaxis:"y2",name:"Humidity",mode:"lines",hovertemplate:" %{y:.0f}%"}],layout:{margin:{t:90,b:90,l:70,r:70,pad:10},autosize:!0,legend:{orientation:"h",yanchor:"bottom",y:1.12,xanchor:"right",x:1},xaxis:{title:{text:"Date/Time"},autorange:"false",type:"date"},yaxis:{title:"Temperature (&deg;C)",automargin:!0,range:[this.state.minY1,this.state.maxY1]},yaxis2:{title:"Humidity (%)",range:[0,100],overlaying:"y",side:"right",automargin:!0},hovermode:"x unified"},useResizeHandler:!0,style:{maxWidth:"100%",height:"100%"}})}}]),a}(i.a.Component),w=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),r=t.call(this,e),Array.isArray(r.props.data)&&(r.state={data:r.props.data,temperatures:r.props.data.map((function(e){return e.temperature})),humidity:r.props.data.map((function(e){return e.humidity})),timestamps:r.props.data.map((function(e){return e.timestamp}))}),r}return Object(u.a)(a,[{key:"componentDidUpdate",value:function(e,t){if(e.data!==this.props.data&&Array.isArray(this.props.data)){var a=this.props.data.map((function(e){return e.temperature})),r=this.props.data.map((function(e){return e.humidity})),i=this.props.data.map((function(e){return e.timestamp}));this.setState({temperatures:a,humidity:r,timestamps:i})}}},{key:"render",value:function(){return Object(j.jsx)("div",{className:"row",children:Object(j.jsx)("div",{className:"col s12 m12 l12",children:Object(j.jsxs)("div",{className:"card blue-grey darken-1",children:[Object(j.jsx)("div",{className:"card-title white-text center-align hide-on-large-only",children:this.props.title}),Object(j.jsx)("div",{className:"card-content white-text",children:null!==this.state?Object(j.jsx)(D,{labelLeft:"Temperature (\u2103)",labelRight:"Humidity (%)",xData:this.state.timestamps,yDataLeft:this.state.temperatures,yDataRight:this.state.humidity,title:" "}):""})]})})})}}]),a}(r.Component),N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,a=/[!"#$%&'()*+,.\xa3\\/:;<=>?@[\]^_`{|}~]/;return!(e.length<t||!0===a.test(e))},C=a(10),_=a.n(C),S="https://home-climate-monitor.herokuapp.com",A=function(){var e=Object(d.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(S,"/device/"),e.next=3,T(t);case 3:return a=e.sent,e.abrupt("return",a.hasOwnProperty("data")?a.data:[]);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(d.a)(l.a.mark((function e(t,a,r){var i,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(S,"/device/create"),n={"Content-Type":"application/json","X-API-KEY":r},e.prev=2,e.next=5,_.a.post(i,{serial:t,description:a},{headers:n},{timeout:1e4});case 5:return e.abrupt("return",e.sent);case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return","Error");case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t,a,r){return e.apply(this,arguments)}}();function T(e){return M.apply(this,arguments)}function M(){return M=Object(d.a)(l.a.mark((function e(t){var a,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:1e4,e.prev=1,e.next=4,_()({method:"get",url:t,timeout:a});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return","Error");case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),M.apply(this,arguments)}var L=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleChange=r.handleChange.bind(Object(h.a)(r)),r.handleChangeNumber=r.handleChangeNumber.bind(Object(h.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object(h.a)(r)),r.state={addingDevice:!1,addButtonDisabled:!0,serial:1,description:"",key:"",keyError:!1,descriptionError:!1,addDeviceError:!1,new_device_key:null,new_device_serial:null},r}return Object(u.a)(a,[{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A();case 2:t=e.sent,a=0,t.forEach((function(e){a=Math.max(e.serial,a)})),this.setState({serial:a+1}),b.a.updateTextFields();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isFormValid",value:function(){var e=this.state.key,t=this.state.description,a=N(e),r=N(t);return this.setState({descriptionError:!r}),this.setState({keyError:!a}),a&&r}},{key:"handleChange",value:function(e){var t=e.target.id,a=e.target.value;N(a,3)&&e.target.validity.valid?("description"===t&&this.setState({description:a,descriptionError:!1}),"pass_or_key"===t&&this.setState({key:a,keyError:!1})):("description"===t&&this.setState({description:a,descriptionError:!0}),"pass_or_key"===t&&this.setState({key:a,keyError:!0})),this.setState({addButtonDisabled:this.state.keyError||this.state.descriptionError})}},{key:"handleChangeNumber",value:function(e){var t=e.target.id,a=e.target.value;e.target.validity.valid?("serial_number"===t&&this.setState({serial:a}),this.setState({addButtonDisabled:this.isFormValid()})):e.target.value=e.target.defaultValue}},{key:"handleSubmit",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),console.log("submit"),!1!==this.isFormValid(t)){e.next=5;break}return e.abrupt("return");case 5:return this.setState({addButtonDisabled:!0}),e.next=8,E(this.state.serial,this.state.description,this.state.key);case 8:return a=e.sent,console.log(a),a.hasOwnProperty("data")&&a.data.hasOwnProperty("key")&&a.data.hasOwnProperty("serial")?this.setState({new_device_key:a.data.key,new_device_serial:a.data.serial}):this.setState({addDeviceError:!0}),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return Object(j.jsxs)("div",{className:"container",children:[Object(j.jsx)("h4",{className:"white-text",children:"Add a Device"}),Object(j.jsxs)("form",{className:"col s12",onSubmit:this.handleSubmit,children:[Object(j.jsxs)("div",{className:"row",children:[Object(j.jsx)("div",{className:"row",children:Object(j.jsxs)("div",{className:"input-field col s12",children:[Object(j.jsx)("input",{name:"serial_number",id:"serial_number",type:"number",value:this.state.serial,min:"1",max:"100",className:"validate white-text",required:!0,onChange:this.handleChangeNumber}),Object(j.jsx)("label",{htmlFor:"serial_number",children:"Device Serial Number"})]})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsxs)("div",{className:"input-field col s12",children:[Object(j.jsx)("input",{name:"description",id:"description",type:"text",className:"validate white-text",maxLength:"50",required:!0,value:this.state.description,onChange:this.handleChange}),Object(j.jsx)("label",{htmlFor:"description",children:"Device Description"})]})}),Object(j.jsx)("div",{className:"row",children:Object(j.jsxs)("div",{className:"input-field col s12",children:[Object(j.jsx)("input",{name:"pass_or_key",id:"pass_or_key",type:"text",className:"validate white-text",required:!0,value:this.state.key,onChange:this.handleChange}),Object(j.jsx)("label",{htmlFor:"pass_or_key",children:"API Key"})]})}),Object(j.jsx)("div",{className:"row",children:this.state.keyError||this.state.descriptionError?Object(j.jsxs)("div",{className:"input-field col s12 red",children:[Object(j.jsx)("p",{children:"Error - invalid description or API key"})," "]}):null}),Object(j.jsx)("div",{className:"row",children:this.state.addDeviceError?Object(j.jsx)("div",{className:"input-field col s12 red",children:Object(j.jsx)("p",{children:"Error adding device"})}):null}),Object(j.jsx)("div",{className:"row",children:this.state.new_device_key?Object(j.jsxs)("div",{className:"input-field col s12",children:[Object(j.jsxs)("p",{children:["API key for device serial #",this.state.new_device_serial," = ",this.state.new_device_key]})," "]}):null})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{className:"waves-effect waves-light red btn-flat form-buttons",children:"Cancel"}),Object(j.jsx)("button",{type:"submit",className:"waves-effect waves-light green btn-flat form-buttons ".concat(this.state.addButtonDisabled?"disabled":null),children:"Add Device"})]})]})]})}}]),a}(i.a.Component),H=L,F=function(){var e=Object(d.a)(l.a.mark((function e(t){var a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(S,"/data/").concat(t,"/last"),e.next=3,U(a);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(d.a)(l.a.mark((function e(t){var a,r,i,n,s=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:new Date,r=s.length>2&&void 0!==s[2]?s[2]:new Date,i="".concat(S,"/data/").concat(t,"?start=").concat(a.replace("Z",""),"&end=").concat(r.replace("Z","")),e.next=5,U(i);case 5:return n=e.sent,e.abrupt("return",n.data);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function U(e){return B.apply(this,arguments)}function B(){return B=Object(d.a)(l.a.mark((function e(t){var a,r=arguments;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.length>1&&void 0!==r[1]?r[1]:1e4,e.prev=1,e.next=4,_()({method:"get",url:t,timeout:a});case 4:return e.abrupt("return",e.sent);case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return","Error");case 10:case"end":return e.stop()}}),e,null,[[1,7]])}))),B.apply(this,arguments)}var P=function(e){Object(p.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(o.a)(this,a),(r=t.call(this,e)).handleChangeDevice=r.handleChangeDevice.bind(Object(h.a)(r)),r.handleBurger=r.handleBurger.bind(Object(h.a)(r)),r.toggleAddDevice=r.toggleAddDevice.bind(Object(h.a)(r)),r.displayGraphs=r.displayGraphs.bind(Object(h.a)(r)),r.state={devices:null,last_readings:[],selected_device:null,device_data:null,add_device:!1},r}return Object(u.a)(a,[{key:"handleBurger",value:function(e){console.log("burger")}},{key:"handleChangeDevice",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var a,r,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,(a=t.hasOwnProperty("target")?t.target.innerText.toLowerCase():t.toLowerCase())!==this.state.selected_device.description.toLowerCase()){e.next=4;break}return e.abrupt("return");case 4:if(0===(r=this.state.devices.filter((function(e){return e.description.toLowerCase()===a}))).length){e.next=11;break}return r=r[0],e.next=9,this.getDataLast24Hours(r.serial);case 9:i=e.sent,this.setState({selected_device:r,device_data:i});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDataLast24Hours",value:function(){var e=Object(d.a)(l.a.mark((function e(t){var a,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}return e.abrupt("return");case 2:if(null!=t){e.next=4;break}return e.abrupt("return");case 4:return(a=new Date).setDate(a.getDate()-1),(r=new Date).setDate(r.getDate()+1),e.abrupt("return",I(t,a.toISOString(),r.toISOString()));case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(d.a)(l.a.mark((function e(){var t,a,r,i,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelectorAll(".datepicker"),t={defaultDate:new Date,setDefaultDate:!0};b.a.Datepicker.init(e,t)})),e.next=3,A();case 3:if(t=e.sent,this.setState({devices:t}),void 0===this.state.devices||null===this.state.devices){e.next=20;break}return this.setState({selected_device:this.state.devices[0]}),e.next=9,Promise.all(this.state.devices.map((function(e){return F(e.serial)})));case 9:if(a=e.sent,this.setState({last_readings:a}),(r=new Date).setDate(r.getDate()-1),(i=new Date).setDate(i.getDate()+1),void 0===this.state.selected_device){e.next=20;break}return e.next=18,I(this.state.selected_device.serial,r.toISOString(),i.toISOString());case 18:void 0!==(n=e.sent)&&this.setState({device_data:n});case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"displayGraphs",value:function(){if(null!=this.state.device_data&&void 0!==this.state.device_data)return 0===this.state.device_data.length?Object(j.jsx)("h1",{className:"white-text center-align",children:"No Data"}):Object(j.jsx)(w,{data:this.state.device_data,title:this.state.selected_device.description})}},{key:"displayCards",value:function(){return null!=this.state.last_readings?Object(j.jsx)(y,{selectedDevice:null!=this.state.selected_device?this.state.selected_device.description:null,readings:this.state.last_readings,devices:this.state.devices,clickHandler:this.handleChangeDevice}):null}},{key:"toggleAddDevice",value:function(){var e=this.state.add_device;this.setState({add_device:!e})}},{key:"render",value:function(){var e=this;return Object(j.jsx)("div",{children:Object(j.jsxs)("div",{className:"row margin-none",children:[Object(j.jsxs)("div",{className:"hide hide-on-med-and-up center-align",children:[Object(j.jsx)("h1",{className:"white-text margin-none header-title",children:"Dashboard"}),Object(j.jsxs)("div",{className:"burger",onClick:this.handleBurger,children:[Object(j.jsx)("div",{}),Object(j.jsx)("div",{}),Object(j.jsx)("div",{})]}),Object(j.jsxs)("ul",{className:"mobileNav",children:[null!=this.state.devices?this.state.devices.map((function(t){return Object(j.jsx)("li",{children:Object(j.jsx)("button",{onClick:e.handleChangeDevice,className:"waves-effect waves-light btn grey darken-2 sidebar-links",children:t.description})},t.serial)})):null,Object(j.jsx)("li",{children:Object(j.jsx)("button",{className:"waves-effect waves-light btn grey darken-2 sidebar-links",onClick:this.toggleAddDevice,children:this.state.add_device?"Show Graphs":"Add Device"})})]})]}),Object(j.jsx)("div",{className:"col s12 m4 l2 blue-grey darken-3 min-height-100 hide-on-med-and-down",children:Object(j.jsxs)("div",{className:"section white-text text-center",children:[Object(j.jsx)("h1",{className:"white-text sidebar-title",children:"Graphs"}),Object(j.jsx)("div",{className:"divider"}),Object(j.jsx)("input",{type:"text",className:"datepicker datepicker-override"}),Object(j.jsxs)("ul",{children:[null!=this.state.devices?this.state.devices.map((function(t){return Object(j.jsx)("li",{children:Object(j.jsx)("button",{onClick:e.handleChangeDevice,className:"waves-effect waves-light btn grey darken-2 sidebar-links",children:t.description})},t.serial)})):null,Object(j.jsx)("div",{className:"divider"}),Object(j.jsx)("li",{children:Object(j.jsx)("button",{className:"waves-effect waves-light btn green darken-4 sidebar-links",onClick:this.toggleAddDevice,children:this.state.add_device?"Show Graphs":"Add Device"})})]})]})}),Object(j.jsxs)("div",{className:"col s12 m12 l10 blue-grey darken-2 min-height-100vh",children:[this.displayCards(),this.state.add_device?Object(j.jsx)(H,{}):this.displayGraphs()]})]})})}}]),a}(r.Component),R=P;var Y=function(){return Object(j.jsx)("div",{className:"App",children:Object(j.jsx)(R,{})})};s.a.render(Object(j.jsx)(i.a.StrictMode,{children:Object(j.jsx)(Y,{})}),document.getElementById("root"))}},[[57,1,2]]]);
//# sourceMappingURL=main.7e4eaf05.chunk.js.map